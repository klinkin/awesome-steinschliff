---
description: Правила и контекст проекта awesome-steinschliff - каталога структур (штайншлифтов) для беговых лыж
globs: "**/*"
alwaysApply: true
---

# Проект: awesome-steinschliff

**Описание:** Awesome Steinschliff — живой каталог знаний о лыжных структурах (штайншлифтах), собранный на основе реального опыта. Проект систематизирует информацию о структурах от различных производителей и сервисов, включая диапазоны температур, типы снега и рекомендации по применению.

## Правила взаимодействия

**При работе с AI ассистентом:**

- Задавать вопросы по одному, а не списком сразу
- Формировать список вопросов и задавать их последовательно
- Получать ответ на один вопрос перед тем, как задать следующий

**При неясностях и неоднозначностях:**

- Не делать предположений - всегда уточнять у пользователя
- Спрашивать о каждой неоднозначности или граничном случае
- Предлагать лучший способ, если он есть
- Перед тем как задать вопрос, подумать: можно ли ответить, рассмотрев более широкий контекст?
- Если да - сделать предварительное предположение и попросить подтверждение

**При документировании:**

- Размещать документацию в директории `docs/`
- Использовать краткие и ёмкие формулировки
- При обновлении CHANGELOG.md - писать лаконично, избегать многословности

## Технологический стек

- **Python 3.13+** - основной язык
- **Poetry** - управление зависимостями
- **Pydantic** - валидация и модели данных
- **Jinja2** - шаблонизация README
- **YAML** - хранение данных о структурах
- **Babel** - интернационализация (i18n)
- **Typer + Rich** - CLI интерфейс
- **Astro** - веб-приложение
- **ruff, black, mypy** - линтинг и форматирование
- **pytest** - тестирование
- **Markdown** - форматирование документов

### Структура проекта

**Контент (данные о структурах):**

- `schliffs/` - YAML файлы структур, сгруппированные по сервисам/производителям:
  - `schliffs/<service>/` - папка сервиса (ekiptime, fischer, ramsau и др.)
  - `schliffs/<service>/_meta.yaml` - метаданные сервиса (название, контакты, адрес)
  - `schliffs/<service>/<structure>.yaml` - данные о конкретной структуре
  - `schliffs/<service>/<structure>/` - папка с изображениями структуры (опционально)
- `snow_conditions/` - классификация снеговых условий по цветам (red, blue, green и др.)

**Шаблоны:**

- `steinschliff/templates/` - Jinja2 шаблоны для генерации README:
  - `readme.jinja2` - основной шаблон
  - `table.jinja2` - таблица структур
  - `service.jinja2` - блок сервиса
  - `toc.jinja2` - оглавление
  - `macros.jinja2` - вспомогательные макросы

**Ресурсы:**

- `steinschliff/` - Python пакет генератора:
  - `models.py` - Pydantic модели (SchliffStructure, SnowCondition и др.)
  - `generator.py` - генерация README
  - `formatters.py` - форматирование данных
  - `i18n.py` - интернационализация
  - `utils.py` - утилиты
- `scripts/` - CLI скрипты:
  - `cli.py` - основной CLI (generate, export-json, export-csv)
  - `manage_translations.py` - управление переводами
- `webapp/` - Astro веб-приложение

**Данные:**

- `steinschliff/translations/` - переводы интерфейса (ru, en)

### Основные команды (Makefile)

**Разработка:**

- `make bootstrap` - установка зависимостей (Poetry + npm)
- `make webapp-dev` - запуск веб-приложения в режиме разработки
- `make webapp-preview` - предпросмотр сборки

**Сборка:**

- `make build` - генерация README.md из YAML файлов
- `make build SORT=temperature` - сортировка по температуре (по умолчанию)
- `make export-json` - экспорт данных в JSON для веб-приложения
- `make export-csv` - экспорт списка структур в CSV
- `make webapp-build` - сборка веб-сайта

**Проверка качества:**

- `make lint` - проверка синтаксиса (mypy, ruff, black)
- `make format` - форматирование кода
- `make test` - запуск тестов
- `make ci` - полный CI пайплайн (lint + test + build)

**Интернационализация:**

- `make i18n-extract` - извлечение строк для перевода
- `make i18n-compile` - компиляция переводов
- `make i18n-list` - список доступных локалей

### Правила работы с контентом

**При создании/редактировании структур:**

1. **Следовать структуре папок:**
   - `schliffs/<service>/<structure>.yaml` - файл структуры
   - `schliffs/<service>/_meta.yaml` - метаданные сервиса (обязательно для нового сервиса)
   - `schliffs/<service>/<structure>/` - папка для изображений (опционально)

2. **Формат YAML файлов структуры:**

```yaml
---
name: AW7                                    # Название структуры (обязательно)
description_ru: описание структуры           # Описание на русском
snow_type:                                   # Типы снега (массив)
  - coarse
  - wet
  - falling
temperature:                                 # Диапазон температур
  - min: -5
    max: 5
condition: red                               # Цвет условий (red/blue/green/yellow/orange/violet/pink/brown)
tags:                                        # Теги для поиска
  - крупнозернистый
  - мокрый
similars:                                    # Похожие структуры (ссылки на файлы)
  - schliffs/ramsau/S13-5.yaml
features:                                    # Особенности применения
  - накатка для водянистого снега
service:
  name: ekiptime                             # Имя сервиса (должно совпадать с папкой)
```

3. **Формат _meta.yaml сервиса:**

```yaml
---
name: Ekiptime
description_ru: Структуры для беговых лыж от компании Ekiptime
website_url: https://ekiptime.ru/services/base_tuning.php
country: Россия
city: Москва
contact:
  phones:
    - "+74997043525"
  address: Москва, стадион Динамо
```

# Содержание каталога

Проект содержит ~185 структур от производителей и сервисов:
- **Россия:** Ekiptime, Marsport, Mass Sport, Serviccer, Skipole, Svecky, Uventa
- **Австрия:** Atomic, Beme, Fischer, Fischer26, Salomon
- **Франция:** Rossignol
- **Германия:** Ramsau
- **Норвегия:** Madshus

## Чек-лист перед коммитом

Перед коммитом должно быть выполнено:

- [ ] Запущен линтинг: `make lint`
- [ ] Запущены тесты: `make test`
- [ ] Собран README: `make build`
- [ ] Проверены все ссылки в документах (нет битых ссылок)
- [ ] Только после этого: `git add`, `git commit`, `git push`

### Workflow разработки

1. **Тестирование изменений:**
   - Добавить/изменить YAML файл структуры
   - Запустить `make build` для регенерации README
   - Проверить результат в README.md
   - Запустить `make lint` и `make test`

2. **Работа с веб-приложением:**
   - `make export-json` - обновить данные для webapp
   - `make webapp-dev` - запустить локальный сервер
   - `make webapp-build` - собрать для продакшена

### Правила оформления

**При работе с документацией:**

- Без эмодзи в юридических документах
- Строго фактично - избегать превосходных степеней
- Точные формулировки - уточнять неоднозначности

**При написании commit messages:**

- Четкое описание изменений
- Указывать затронутые структуры/сервисы
- Примеры: `feat: add AC5 structure for Ekiptime`, `fix: correct temperature range for S13-5`

### Git workflow

**Основные правила:**

- Все изменения в контенте - отдельные коммиты
- Изменения в шаблонах/стилях - проверить генерацию README
- Не коммитить папку `webapp/dist/` (результаты сборки)
- Проверять отсутствие `.git/index.lock` перед git командами

**Структура коммита:**

```bash
# 1. Проверить статус
git status

# 2. Добавить изменения
git add <files>

# 3. Коммит с понятным сообщением
git commit -m "feat(ekiptime): add new cold structure AC6"

# 4. Push (только после всех проверок)
git push
```

### Полезные файлы

- `Makefile` - все основные команды
- `pyproject.toml` - конфигурация Python проекта
- `steinschliff/models.py` - модели данных (SchliffStructure, SnowCondition)
- `snow_conditions/*.yaml` - справочник снеговых условий
